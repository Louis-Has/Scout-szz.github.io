<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="left=device-left, initial-scale=1.0">
    <title>drag</title>
    <style>
        div {
            width: 80px;
            height: 60px;
            position: fixed;
            user-select: none;
        }


        /* body {
            overflow: scroll;
        } */
    </style>
</head>

<body>
    <div class="dragable" style="left: 20px; top: 20px; background: pink"></div>
    <div class="dragable" style="left: 30px; top: 30px; background: blue"></div>
    <div class="dragable" style="left: 40px; top: 40px; background: darkorchid"></div>
    <div class="dragable" style="left: 50px; top: 50px; background: darkgreen"></div>
    <script>

        // let dragable = document.querySelector('.dragable')
        
        let maxZIndex = 1
        addEventListener('mousedown', function (e) {
            let startx = e.clientX
            let starty = e.clientY
            e.target.style.zIndex = maxZIndex++

            let elstartx = parseFloat(e.target.style.left)
            let elstarty = parseFloat(e.target.style.top)
            addEventListener('mousemove', function move(f) {
                if (f.which == 0 || f.buttons === 0) {
                    removeEventListener('mousemove', move)
                    console.log('removed!')
                    return
                }
                let dx = elstartx + f.clientX - startx
                let dy = elstarty + f.clientY - starty
                console.log(dx)

                let autoFit = 10

                if (dx < autoFit) {
                    dx = 0
                }
                if (dx > document.documentElement.clientWidth - e.target.offsetWidth - autoFit) {
                    dx = document.documentElement.clientWidth - e.target.offsetWidth
                }

                if (dy < autoFit) {
                    dy = 0
                }
                if (dy > document.documentElement.clientHeight - e.target.offsetHeight - autoFit) {
                    dy = document.documentElement.clientHeight - e.target.offsetHeight
                }

                // startx = f.clientX
                // starty = f.clientY

                e.target.style.left = dx + 'px'
                e.target.style.top = dy + 'px'

            })
        })
    </script>
</body>

</html>